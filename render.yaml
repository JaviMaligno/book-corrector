# Render Blueprint for Spanish Text Corrector
# https://render.com/docs/blueprint-spec

services:
  # FastAPI Backend
  - type: web
    name: corrector-api
    runtime: docker
    dockerfilePath: ./server/Dockerfile
    dockerContext: .
    plan: free
    region: oregon  # or frankfurt, singapore
    branch: main

    # Health check endpoint
    healthCheckPath: /health

    # Environment variables
    envVars:
      - key: GOOGLE_API_KEY
        sync: false  # Set manually in Render dashboard (secret)

      - key: GEMINI_MODEL
        value: gemini-2.5-flash

      - key: DATABASE_URL
        fromDatabase:
          name: corrector-db
          property: connectionString

      - key: STORAGE_DIR
        value: /data

      - key: DEMO_PLAN
        value: free

      - key: SYSTEM_MAX_WORKERS
        value: 2

      - key: LOG_LEVEL
        value: info

      # Python settings
      - key: PYTHONUNBUFFERED
        value: 1

      - key: PYTHONDONTWRITEBYTECODE
        value: 1

    # Persistent disk for file uploads/outputs
    disk:
      name: corrector-storage
      mountPath: /data
      sizeGB: 1  # Free tier: 1GB

# Databases
databases:
  # PostgreSQL database (Neon recommended for long-term free tier)
  # Render's free PostgreSQL expires after 90 days
  # For production, use Neon Postgres (see guide)
  - name: corrector-db
    databaseName: corrector
    plan: free  # 90 days free, then $7/month
    # user: corrector  # Auto-generated
    # Note: Migrate to Neon Postgres for permanent free tier

# Notes:
# 1. Free web services sleep after 15 min of inactivity
#    - Use external keep-alive service (cron-job.org)
#    - Or upgrade to Starter plan ($7/month for no sleep)
#
# 2. PostgreSQL free tier expires after 90 days
#    - Recommended: Use Neon Postgres (free forever)
#    - Set DATABASE_URL manually to Neon connection string
#
# 3. Background workers not available on free tier
#    - App already uses in-process workers (server/worker.py)
#    - Works fine on free tier with single web service
#
# 4. Disk storage: 1GB included (upgradeable to 10GB for $1/month)
#
# 5. First deploy may take 5-10 minutes (Docker build)
#    - Subsequent deploys are faster (cached layers)
#
# 6. To deploy:
#    - Push this file to your GitHub repo
#    - Connect repo to Render
#    - Render auto-detects render.yaml and deploys
